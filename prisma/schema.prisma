generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model ScanSession {
  id           String    @id @default(uuid())
  url_base     String
  status       String    @default("iniciado")
  total_links  Int       @default(0)
  depthReached Int?
  errorMessage String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  links        Link[]    @relation("SessionLinks")
}

model Link {
  id              Int       @id @default(autoincrement())
  url             String
  finalUrl        String?
  tipo            String
  origem          String
  status          String
  httpCode        Int?
  responseTime    Int?
  profundidade    Int?
  session_id      String
  createdAt       DateTime  @default(now())
  session         ScanSession @relation("SessionLinks", fields: [session_id], references: [id], onDelete: Cascade)

  @@unique([url, session_id])
  @@index([session_id])
}

model Requisito {
  id          Int      @id @default(autoincrement())
  texto       String
  textoAjuda  String?
  linkFixo    String?
  pontuacao   Int
  respostas   Resposta[]
}

model Avaliacao {
  id               Int        @id @default(autoincrement())
  urlSecretaria    String
  nomeResponsavel  String
  emailResponsavel String
  status           String     @default("enviado")
  createdAt        DateTime   @default(now())
  secretaria       Secretaria @relation(fields: [secretariaId], references: [id])
  secretariaId     Int
  respostas        Resposta[]
}

model Resposta {
  id              Int      @id @default(autoincrement())
  atende          Boolean
  linkComprovante String?
  foiAutomatico   Boolean  @default(false)
  requisito       Requisito @relation(fields: [requisitoId], references: [id])
  requisitoId     Int
  avaliacao       Avaliacao @relation(fields: [avaliacaoId], references: [id], onDelete: Cascade)
  avaliacaoId     Int
}

model Secretaria {
  id         Int         @id @default(autoincrement())
  nome       String      @unique
  sigla      String      @unique
  url        String
  avaliacoes Avaliacao[]
}